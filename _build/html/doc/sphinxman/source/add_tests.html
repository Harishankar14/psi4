<!DOCTYPE html>

<html lang="English" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Test Suite &#8212; Psi4 Documentation 1.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=29ef4520"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="test-suite">
<span id="faq-add-tests"></span><h1>Test Suite<a class="headerlink" href="#test-suite" title="Link to this heading">¶</a></h1>
<p>A test suite plays a vital role in open-source software use and development.</p>
<ul class="simple">
<li><p>For a <a href="#id32"><span class="problematic" id="id33">|PSIfour|</span></a> user, tests provide models of inputs that should work
&quot;as-is&quot; and a searchable collection of syntax and capabilities.
The test suite also allows high-quality development snapshots of the
codebase to be built automatically for users.</p></li>
<li><p>For a user who has <a href="#id34"><span class="problematic" id="id35">|PSIfour|</span></a> as part of a complex computational molecular software environment, a test suite alongside installed <a href="#id36"><span class="problematic" id="id37">|PSIfour|</span></a> can be used to show that the <a href="#id38"><span class="problematic" id="id39">|PSIfour|</span></a> piece is working.</p></li>
<li><p>For a feature developer, adding tests provides confidence that you
can leave your code untouched and still advertise that the feature works
years later. With tests, proposed changes to <a href="#id40"><span class="problematic" id="id41">|PSIfour|</span></a> that break your
code fall upon the change proposer to fix, rather than being merged
silently and lying in wait for a concientious user to detect and report
and then likely falling upon <em>you</em> to fix.</p></li>
<li><p>For a general developer, the test suite allows confidence in refactoring, switching out underlying libraries, maintenance, and upgrading.</p></li>
</ul>
<section id="ctest-and-pytest-psithon-and-psiapi">
<h2>CTest and pytest, PSIthon and PsiAPI<a class="headerlink" href="#ctest-and-pytest-psithon-and-psiapi" title="Link to this heading">¶</a></h2>
<p>In designing a test, sometimes you want it to be a model input for the user in a single file or you don't want a lot of <code class="docutils literal notranslate"><span class="pre">psi4.</span></code> or Python syntax cluttering the input.
In this case, follow <a class="reference internal" href="#faq-add-psithon-tests"><span class="std std-ref">Adding PSIthon Test Cases</span></a> to prepare as PSIthon (<code class="docutils literal notranslate"><span class="pre">psi4</span> <span class="pre">input.dat</span></code>) for, roughly speaking, running through <strong class="program">ctest</strong>.
The PSIthon/CTest test suite occupies the whole of <a href="#id1"><span class="problematic" id="id2">:source:`tests`</span></a> <em>except</em> <a href="#id3"><span class="problematic" id="id4">:source:`tests/pytests`</span></a>.</p>
<p>At other times you want the test to check several variations of a template job or you want to test error handling or you want to focus on PsiAPI rather than PSIthon or you want to control the compute conditions with environment variables.
In this case, follow <a class="reference internal" href="#faq-add-psiapi-tests"><span class="std std-ref">Adding PsiAPI Test Cases</span></a> to prepare as PsiAPI (<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">psi4</span></code>) for, roughly speaking, running through <strong class="program">pytest</strong>.
The PsiAPI/pytest test suite occupies <a href="#id5"><span class="problematic" id="id6">:source:`tests/pytests`</span></a>.</p>
<p>The above description sounds as if there are two disjoint test suites, and you have to run both <code class="docutils literal notranslate"><span class="pre">ctest</span></code> and <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to fully test <a href="#id42"><span class="problematic" id="id43">|PSIfour|</span></a>.
This has indeed been the case until March 2022.
The difficulty has been that (1) two test suites is unexpected so some developers don't know to run both; and (2) there are important tests in the PSIthon suite that can't be run on a <a href="#id44"><span class="problematic" id="id45">|PSIfour|</span></a> installation since CTest only works in a build directory.
Now, by adding an extra file to the test directory (<a class="reference internal" href="#faq-psithon-through-pytest"><span class="std std-ref">test_input.py</span></a>), PSIthon tests can also be run through <strong class="program">pytest</strong>.
This hasn't rolled out to all ~500 PSIthon tests (help wanted), but eventually <a href="#id46"><span class="problematic" id="id47">|PSIfour|</span></a> can be tested with a single command from a build or from an installation.
Therefore, in designing a test, choose its mode based on whether PSIthon or PsiAPI suits it better and whether it's a simple model for users (probably PSIthon) or for expert users (probably PsiAPI).
Both will continue to work in future, and neither have limitations.</p>
</section>
<section id="test-contents">
<h2>Test Contents<a class="headerlink" href="#test-contents" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Most <a href="#id48"><span class="problematic" id="id49">|PSIfour|</span></a> tests will be integration tests focusing on non-regression of user input to answers, and we insist on having these.
But if you find unit tests helpful, by all means add them to the test suite.</p></li>
<li><p>Most tests should store reference results (from literature or another implementation or a carefully run <a href="#id50"><span class="problematic" id="id51">|PSIfour|</span></a> calculation),
run quantum chemistry, then apply one or more of the <a class="reference internal" href="#faq-comparison-functions"><span class="std std-ref">Comparison Functions</span></a> so that the test will fail if the answer is unexpected.
The functions are the same in CTest and pytest, but in the former they are, for example, <code class="docutils literal notranslate"><span class="pre">compare_matrices(refmat,</span> <span class="pre">mat,</span> <span class="pre">...)</span></code> while in the latter it's asserted, like <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">compare_matrices(refmat,</span> <span class="pre">mat,</span> <span class="pre">...)</span></code>.
The main advantage of the testing functions is that they provide helpful error printing upon failure. Deep down, they're NumPy functions.</p></li>
<li><p>In preparing the test case reference values, aim for the converged value rather than many digits from your computer under default convergence conditions.
This will make the test more robust for different OS, different BLAS libraries, and variations in SCF cycles.
Turn energy, density, amplitude, and geometry convergence criteria to very tight levels, and use these results for reference energies, reference geometries, reference cube files, <em>etc.</em>.
Then, either remove or relax the convergence settings, if these are not a vital part of the test.
In choosing the number of digits for <code class="xref py py-func docutils literal notranslate"><span class="pre">compare_values()</span></code> and other compare_* functions, select a number looser than the convergence set in the test
or the default convergence for the calculation type (energy, gradient, <em>etc.</em>).</p></li>
<li><p>Keep tests as short as possible without sacrificing coverage and variety. Under 30 seconds is a good aim.</p></li>
</ul>
</section>
<section id="adding-psithon-test-cases">
<span id="faq-add-psithon-tests"></span><h2>Adding PSIthon Test Cases<a class="headerlink" href="#adding-psithon-test-cases" title="Link to this heading">¶</a></h2>
<p>To create a new test case, first make a folder in <a href="#id7"><span class="problematic" id="id8">:source:`tests`</span></a> or, for an addon, a subfolder under the addon folder.
Use hyphens, not spaces or underscores, in the directory name.
Add the directory name to the list of tests in <a href="#id9"><span class="problematic" id="id10">:source:`tests/CMakeLists.txt`</span></a> or, for an addon, <code class="docutils literal notranslate"><span class="pre">tests/&lt;addon&gt;/CMakeLists.txt</span></code>.
The test directory will need at least two files, <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">input.dat</span></code>.</p>
<section id="cmakelists-txt">
<h3><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code><a class="headerlink" href="#cmakelists-txt" title="Link to this heading">¶</a></h3>
<p>This file adds the test case to the suite. It should have at least the following two uncommented lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="n">TestingMacros</span><span class="p">)</span>

<span class="c1"># if extra files needed</span>
<span class="c1"># file(COPY grid.dat DESTINATION ${CMAKE_CURRENT_BINARY_DIR})</span>

<span class="n">add_regression_test</span><span class="p">(</span><span class="n">directory_name</span> <span class="s2">&quot;psi;semicolon_separated-list-of-applicable-test-labels&quot;</span><span class="p">)</span>

<span class="c1"># if minutes long</span>
<span class="c1"># set_tests_properties(isapt1 PROPERTIES COST 300)</span>
</pre></div>
</div>
<p>The labels specify which groups of tests include the test case for <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-L</span> <span class="pre">label</span></code> purposes. The <code class="docutils literal notranslate"><span class="pre">psi</span></code> label should always be added, but the other labels are test-specific. The method tested should always be included, and this is often sufficient. If adding a test for an already existing module, the labels for other tests of the module will suggest other labels to add.
Labels have been added as developers needed, so they are not systematic or thorough. If you see labels to add or rename, please do.</p>
<p>A test requiring over 15 minutes should be labeled <code class="docutils literal notranslate"><span class="pre">longtests</span></code>. A short test under 30 seconds used for general bug checking should be labeled <code class="docutils literal notranslate"><span class="pre">quicktests</span></code>. A test that confirms <a href="#id52"><span class="problematic" id="id53">|PSIfour|</span></a> is operational should be labeled <code class="docutils literal notranslate"><span class="pre">smoketests</span></code>.</p>
<p>If a test needs extra input files like <code class="docutils literal notranslate"><span class="pre">grid.dat</span></code> or extra reference files for checking against, like <code class="docutils literal notranslate"><span class="pre">fchk</span></code>, specify these in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> as shown above. Such tests must be run through <code class="docutils literal notranslate"><span class="pre">ctest</span></code> and don't usually work when run &quot;by hand&quot; from the objdir via <code class="docutils literal notranslate"><span class="pre">stage/bin/psi4</span> <span class="pre">../tests/directory_name/input.dat</span></code>.</p>
<p>If a test is multiple minutes long, load-balancing a parallel CTest run requires the test to be started early. Use the <code class="docutils literal notranslate"><span class="pre">COST</span></code> line as shown above to set a weighting to about the number of seconds the test takes.</p>
</section>
<section id="input-dat">
<h3><code class="docutils literal notranslate"><span class="pre">input.dat</span></code><a class="headerlink" href="#input-dat" title="Link to this heading">¶</a></h3>
<p>The other necessary file is the input file itself, <code class="docutils literal notranslate"><span class="pre">input.dat</span></code>. The input file should be just a simple input file to run the test, with small additions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#! RI-SCF cc-pVTZ energy of water, with Z-matrix input and cc-pVTZ-RI auxiliary basis.</span>
<span class="c1">#! Also a bit more to force a second line.</span>

<span class="n">nucenergy</span> <span class="o">=</span> <span class="mf">8.801466202085710</span>  <span class="c1">#TEST</span>
<span class="n">refenergy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">76.05098402733282</span>  <span class="c1">#TEST</span>

<span class="n">molecule</span> <span class="n">h2o</span> <span class="p">{</span>
   <span class="n">symmetry</span> <span class="n">c1</span>
   <span class="n">O</span>
   <span class="n">H</span> <span class="mi">1</span> <span class="mf">1.0</span>
   <span class="n">H</span> <span class="mi">1</span> <span class="mf">1.0</span> <span class="mi">2</span> <span class="mf">104.5</span>
<span class="p">}</span>

<span class="nb">set</span> <span class="p">{</span>
   <span class="n">basis</span> <span class="n">cc</span><span class="o">-</span><span class="n">pVTZ</span>
   <span class="n">scf_type</span> <span class="n">df</span>
   <span class="n">df_basis_scf</span> <span class="n">cc</span><span class="o">-</span><span class="n">pVTZ</span><span class="o">-</span><span class="n">RI</span>
   <span class="n">e_convergence</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="n">thisenergy</span> <span class="o">=</span> <span class="n">energy</span><span class="p">(</span><span class="s2">&quot;hf&quot;</span><span class="p">)</span>

<span class="n">compare_values</span><span class="p">(</span><span class="n">nucenergy</span><span class="p">,</span> <span class="n">h2o</span><span class="o">.</span><span class="n">nuclear_repulsion_energy</span><span class="p">(),</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Nuclear repulsion energy&quot;</span><span class="p">)</span>  <span class="c1">#TEST</span>
<span class="n">compare_values</span><span class="p">(</span><span class="n">refenergy</span><span class="p">,</span> <span class="n">thisenergy</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Reference energy&quot;</span><span class="p">)</span>  <span class="c1">#TEST</span>
<span class="n">compare_values</span><span class="p">(</span><span class="n">refenergy</span><span class="p">,</span> <span class="n">variable</span><span class="p">(</span><span class="s1">&#39;scf total energy&#39;</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;Reference energy&quot;</span><span class="p">)</span>  <span class="c1">#TEST</span>
</pre></div>
</div>
<p>Of those small modifications, first, note the special comment at the top (starting with the <code class="docutils literal notranslate"><span class="pre">#!</span></code> comment marker). This should be descriptive since it is inlined into the manual (unless <code class="docutils literal notranslate"><span class="pre">!nosample</span></code> in the comment) as a sample input.</p>
<p>Reference values are often assigned to variables for later use.
The compare_values function (along with several relatives in <a href="#id11"><span class="problematic" id="id12">:source:`psi4/driver/p4util/testing.py`</span></a> for comparing strings, matrices, etc.) checks that the computed values match these reference values to suitable precision. This function prints an error message and signals that the test failed to the make system, if the values don't match. Any lines of the input associated with the validation process should be flagged with <code class="docutils literal notranslate"><span class="pre">#TEST</span></code> at the end of each line, so that they can be removed when copying from the tests to the samples directory.</p>
</section>
<section id="output-ref">
<h3><code class="docutils literal notranslate"><span class="pre">output.ref</span></code><a class="headerlink" href="#output-ref" title="Link to this heading">¶</a></h3>
<p>When your test case is in final form, run it locally, rename the output to <code class="docutils literal notranslate"><span class="pre">output.ref</span></code>, and check it into the repository alongside <code class="docutils literal notranslate"><span class="pre">input.dat</span></code>.
While this isn't used for any testing machinery, it can be handy for users or developers to consult.</p>
</section>
<section id="test-input-py">
<span id="faq-psithon-through-pytest"></span><h3><code class="docutils literal notranslate"><span class="pre">test_input.py</span></code><a class="headerlink" href="#test-input-py" title="Link to this heading">¶</a></h3>
<p>Starting March 2022, one can also run tests designed as above for CTest through pytest.
To bring the test to pytest's notice, add a file to the directory named <code class="docutils literal notranslate"><span class="pre">test_input.py</span></code>.
Below is an example for the <a href="#id13"><span class="problematic" id="id14">:source:`tests/ci-property/test_input.py`</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">addons</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@ctest_labeler</span><span class="p">(</span><span class="s2">&quot;quick;ci;cas;properties;cart;noc1&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_ci_property</span><span class="p">():</span>
    <span class="n">ctest_runner</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;grid.dat&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>This file contains much the same information as the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.
The <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">test_ci_property</span></code> contains the name of the test, now with underscores rather than hyphens.
<code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">test_</span></code> identifies it to pytest as a test.
That part of the function name and the name of the file, <code class="docutils literal notranslate"><span class="pre">test_input.py</span></code> are required, but no further registration with CMake is necessary.
Most tests need only the simple form of the runner line <code class="docutils literal notranslate"><span class="pre">ctest_runner(__file__)</span></code>.
This uses QCEngine machinery to execute <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">psi4</span> <span class="pre">input.dat</span></code>.
If additional input files are needed from the test directory, their names can be added to the the second argument list as shown above.
Those additional input files <em>do</em> need to be registered in <a href="#id15"><span class="problematic" id="id16">:source:`psi4/CMakeLists.txt`</span></a>.</p>
<p>Finally, the label string passed to CTest is here handed to pytest, with a few changes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">psi</span></code> added automatically, so exclude it when copying from CTest <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cli</span></code> added automatically to distinguish CTest origin from deliberate pytest origin, which have <code class="docutils literal notranslate"><span class="pre">api</span></code> added</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">smoke</span></code> used instead of CTest <code class="docutils literal notranslate"><span class="pre">smoketests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quick</span></code> used instead of CTest <code class="docutils literal notranslate"><span class="pre">quicktests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">long</span></code> used instead of CTest <code class="docutils literal notranslate"><span class="pre">longtests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">addon</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;name-of-addon&gt;</span></code> added automatically when <code class="docutils literal notranslate"><span class="pre">&#64;uusing(&quot;&lt;name-of-addon&gt;&quot;)</span></code> decorates the test or <code class="docutils literal notranslate"><span class="pre">marks=using(&quot;&lt;name-of-addon&gt;&quot;)</span></code> marks the test</p></li>
</ul>
<p>CTest &quot;labels&quot; are called &quot;marks&quot; in pytest.
Any new marks should be added to <a href="#id17"><span class="problematic" id="id18">:source:`pytest.ini`</span></a>.</p>
</section>
<section id="running-for-debugging">
<h3>Running for Debugging<a class="headerlink" href="#running-for-debugging" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>PSIthon tests that don't need extra files to run are easily run from <code class="docutils literal notranslate"><span class="pre">&lt;objdir&gt;</span></code> via <code class="docutils literal notranslate"><span class="pre">stage/bin/psi4</span> <span class="pre">../tests/&lt;test-name&gt;/input.dat,</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">output</span> <span class="pre">appearing</span> <span class="pre">in</span> <span class="pre">``../tests/&lt;test-name&gt;/input.out</span></code>.</p></li>
<li><p>All PSIthon tests are runable through CTest, and output files appear in <code class="docutils literal notranslate"><span class="pre">&lt;objdir&gt;/tests/&lt;test-name&gt;/output.dat</span></code> and stdout results appear in <code class="docutils literal notranslate"><span class="pre">&lt;objdir&gt;/Testing/Temporary/LastTest.log*</span></code>.</p></li>
</ul>
</section>
</section>
<section id="adding-psiapi-test-cases">
<span id="faq-add-psiapi-tests"></span><h2>Adding PsiAPI Test Cases<a class="headerlink" href="#adding-psiapi-test-cases" title="Link to this heading">¶</a></h2>
<p>To create a new test case, either create a new file or add to an existing file under <a href="#id19"><span class="problematic" id="id20">:source:`tests/pytests`</span></a>.</p>
<ul class="simple">
<li><p>Test must be in the <a href="#id21"><span class="problematic" id="id22">:source:`tests/pytests/`</span></a> directory.</p></li>
<li><p>Test file name must start with <code class="docutils literal notranslate"><span class="pre">test_</span></code>. This is how pytest knows to collect it.</p></li>
<li><p>A test file may contain many tests, each of which is an ordinary Python function with name starting <code class="docutils literal notranslate"><span class="pre">test_</span></code>. This is how pytest knows to collect it.</p></li>
<li><p>No registration required to bring a test to pytest's attention.</p></li>
<li><p>No registration required to bring a test to CMake's attention. If a test needs additional files, register them in <a href="#id23"><span class="problematic" id="id24">:source:`psi4/CMakeLists.txt`</span></a>.</p></li>
</ul>
<p>A few notes on test contents:</p>
<ul class="simple">
<li><p>Import testing functions from <code class="docutils literal notranslate"><span class="pre">utils</span></code> and use Python assert: <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">compare_values(expected,</span> <span class="pre">computed,</span> <span class="pre">...)</span></code>.</p></li>
<li><p>Don't worry about cleaning up files or resetting options. A function in <a href="#id25"><span class="problematic" id="id26">:source:`tests/pytests/conftest.py`</span></a> does this automatically between every test.</p></li>
<li><p>Especially if using data or functions from outside a test, run a variety of tests at different <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-n</span> <span class="pre">&lt;N&gt;</span></code> levels to mix up test ordering. If tests fail that pass when run alone, you've got a function of the same name changing state or some similar correctable phenomenon.</p></li>
</ul>
<p>A few notes on test labels:</p>
<ul class="simple">
<li><p>For every new test file, add <code class="docutils literal notranslate"><span class="pre">pytestmark</span> <span class="pre">=</span> <span class="pre">[pytest.mark.psi,</span> <span class="pre">pytest.mark.api]</span></code> at the top.
This ensures that every test has the <code class="docutils literal notranslate"><span class="pre">psi</span></code> mark and every PsiAPI test has the <code class="docutils literal notranslate"><span class="pre">api</span></code> mark to contrast with PSIthon tests with <code class="docutils literal notranslate"><span class="pre">cli</span></code> mark.</p></li>
<li><p>There are individual &quot;marks&quot; that can be added to whole tests or parts
of parameterized tests so that they can be run by category (<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-m</span> <span class="pre">&lt;mark&gt;</span></code>
vs. <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-L</span> <span class="pre">&lt;mark&gt;</span></code>) rather than just by name (<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-k</span> <span class="pre">&lt;name_fragment&gt;</span></code>
vs. <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-R</span> <span class="pre">&lt;name_fragment&gt;</span></code>). Far more complicated logic is allowed than for
CTest: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-m</span> <span class="pre">&quot;dftd3</span> <span class="pre">and</span> <span class="pre">not</span> <span class="pre">api</span> <span class="pre">and</span> <span class="pre">not</span> <span class="pre">long&quot;</span></code>.</p></li>
<li><p>The most important marks are &quot;quick&quot; and &quot;long&quot; that opt tests into the quick CI suite or out of
the normal full suite. Mark with a decorator for the full test or the
marks argument in a parameterized test. Search &quot;mark&quot; in the test suite
for examples. Use &quot;quick&quot; freely for tests that cover functionality and
are under 15s. Use &quot;long&quot; sparingly to winnow out the longest examples,
particularly those over a minute.</p></li>
</ul>
<section id="id27">
<h3>Running for Debugging<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h3>
<p>There are many ways to run pytest, <a class="reference internal" href="build_planning.html#faq-pytest"><span class="std std-ref">How to test a Psi4 installation</span></a>, and three different copies of the test file
(i.e., <a href="#id28"><span class="problematic" id="id29">:source:`tests/pytests/test_mp2.py`</span></a>, <code class="docutils literal notranslate"><span class="pre">&lt;objdir&gt;/stage/lib/PYMOD_INSTALL_LIBDIR/psi4/tests/test_mp2.py</span></code>,
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX/lib/PYMOD_INSTALL_LIBDIR/psi4/tests/test_mp2.py</span></code>).
But for developing a pytest test, you probably want to use the first so you can edit it in place rather than running <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--build</span></code> after each change.</p>
<ul class="simple">
<li><p>Easiest is from &lt;objdir&gt;, run <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">../tests</span></code>. Add any filters (<code class="docutils literal notranslate"><span class="pre">-k</span>
<span class="pre">test_name_fragment</span></code>) or parallelism (<code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">&lt;N&gt;</span></code>  or <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">auto</span></code> if <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code>
installed) or print test names (<code class="docutils literal notranslate"><span class="pre">-v</span></code>) or print warnings (<code class="docutils literal notranslate"><span class="pre">-rws</span></code>).</p></li>
<li><p>An important point is that because they're PsiAPI, <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">psi4</span></code> is happening,
so the &lt;objdir&gt; <a href="#id54"><span class="problematic" id="id55">|PSIfour|</span></a> module must be in <span class="target" id="index-0"></span><a class="reference internal" href="external.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a>. Also, any call
to QCEngine is using <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">psi4</span></code>, so the &lt;objdir&gt; <a href="#id56"><span class="problematic" id="id57">|PSIfour|</span></a> executable must be in
<span class="target" id="index-1"></span><a class="reference internal" href="external.html#envvar-PATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code></a>. The easiest way to prepare your local environment is to
execute the printout of <code class="docutils literal notranslate"><span class="pre">&lt;objdir&gt;/stage/bin/psi4</span> <span class="pre">--psiapi</span></code>.</p></li>
<li><p>To see stdout output from an otherwise passing test, easiest to add <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">0</span></code>
at its end to trigger failure.</p></li>
<li><p>If stdout printing is insufficient, and you really need to see <code class="docutils literal notranslate"><span class="pre">output.dat</span></code> or other files,
comment out their deletion in <a href="#id30"><span class="problematic" id="id31">:source:`tests/pytests/conftest.py`</span></a> and run the single test, deleting
the file each time (since it appends).</p></li>
</ul>
</section>
</section>
<section id="comparison-functions">
<span id="faq-comparison-functions"></span><h2>Comparison Functions<a class="headerlink" href="#comparison-functions" title="Link to this heading">¶</a></h2>
<section id="plain-old-data">
<h3>Plain Old Data<a class="headerlink" href="#plain-old-data" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">psi4.</span></span><span class="sig-name descname"><span class="pre">compare_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">computed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atol_exponent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="optional">]</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</section>
<section id="objects">
<h3>Objects<a class="headerlink" href="#objects" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">psi4.</span></span><span class="sig-name descname"><span class="pre">compare_matrices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">computed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atol_exponent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_name=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="optional">]</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">psi4.</span></span><span class="sig-name descname"><span class="pre">compare_vectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">computed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atol_exponent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_name=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="optional">]</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">psi4.</span></span><span class="sig-name descname"><span class="pre">compare_wavefunctions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">computed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atol_exponent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_name=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="optional">]</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</section>
<section id="file-formats">
<h3>File Formats<a class="headerlink" href="#file-formats" title="Link to this heading">¶</a></h3>
</section>
<section id="extra-qca-functions">
<h3>Extra QCA Functions<a class="headerlink" href="#extra-qca-functions" title="Link to this heading">¶</a></h3>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Psi4 Documentation</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Harishankar.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/doc/sphinxman/source/add_tests.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>