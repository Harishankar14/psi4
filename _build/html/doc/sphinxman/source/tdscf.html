<!DOCTYPE html>

<html lang="English" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>TDSCF: Time-dependent Hartree--Fock and density-functional theory &#8212; Psi4 Documentation 1.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=29ef4520"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tdscf-time-dependent-hartree-fock-and-density-functional-theory">
<span id="sec-tdscf"></span><span id="index-0"></span><h1>TDSCF: Time-dependent Hartree--Fock and density-functional theory<a class="headerlink" href="#tdscf-time-dependent-hartree-fock-and-density-functional-theory" title="Link to this heading">¶</a></h1>
<p><em>Module:</em> <span class="xref std std-ref">Keywords</span>, <span class="xref std std-ref">PSI Variables</span>, <a href="#id1"><span class="problematic" id="id2">:source:`LIBSCF_SOLVER &lt;psi4/src/psi4/libscf_solver&gt;`</span></a></p>
<section id="introduction">
<span id="sec-tdscfintro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p><a href="#id10"><span class="problematic" id="id11">|PSIfour|</span></a> provides the capability to calculate excitation energies and ground to
excited state transition properties for SCF reference wavefunctions in a linear
response formalism <a class="reference internal" href="bibliography.html#dreuw2005-wp" id="id3"><span>[Dreuw2005-wp]</span></a>.</p>
<p>An illustrative example of using the TDSCF functionality is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="p">{</span>
<span class="mi">0</span> <span class="mi">1</span>
<span class="n">O</span>        <span class="mf">0.000000</span>    <span class="mf">0.695000</span>   <span class="o">-</span><span class="mf">0.092486</span>
<span class="n">O</span>       <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.695000</span>   <span class="o">-</span><span class="mf">0.092486</span>
<span class="n">H</span>       <span class="o">-</span><span class="mf">0.388142</span>    <span class="mf">0.895249</span>    <span class="mf">0.739888</span>
<span class="n">H</span>        <span class="mf">0.388142</span>   <span class="o">-</span><span class="mf">0.895249</span>    <span class="mf">0.739888</span>
<span class="n">symmetry</span> <span class="n">c1</span>
<span class="p">}</span>

<span class="nb">set</span> <span class="p">{</span>
<span class="n">tdscf_states</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="n">energy</span><span class="p">(</span><span class="s1">&#39;td-scf/cc-pvdz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will seek to converge 10 singlet roots from a restricted Hartree--Fock reference. The roots are obtained with an iterative eigensolver and the following is the printout from the calculation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="o">---------------------------------------------------------</span>
                       <span class="n">TDSCF</span> <span class="n">excitation</span> <span class="n">energies</span>
               <span class="n">by</span> <span class="n">Andrew</span> <span class="n">M</span><span class="o">.</span> <span class="n">James</span> <span class="ow">and</span> <span class="n">Daniel</span> <span class="n">G</span><span class="o">.</span> <span class="n">A</span><span class="o">.</span> <span class="n">Smith</span>
       <span class="o">---------------------------------------------------------</span>

<span class="o">==&gt;</span> <span class="n">Options</span> <span class="o">&lt;==</span>

   <span class="n">Residual</span> <span class="n">threshold</span>  <span class="p">:</span> <span class="mf">1.0000e-04</span>
   <span class="n">Initial</span> <span class="n">guess</span>       <span class="p">:</span> <span class="n">denominators</span>
   <span class="n">Reference</span>           <span class="p">:</span> <span class="n">RHF</span>
   <span class="n">Solver</span> <span class="nb">type</span>         <span class="p">:</span> <span class="n">RPA</span> <span class="p">(</span><span class="n">Hamiltonian</span><span class="p">)</span>


<span class="o">==&gt;</span> <span class="n">Requested</span> <span class="n">Excitations</span> <span class="o">&lt;==</span>

    <span class="mi">10</span> <span class="n">singlet</span> <span class="n">states</span> <span class="k">with</span> <span class="n">A</span> <span class="n">symmetry</span>


<span class="o">==&gt;</span> <span class="n">Seeking</span> <span class="n">the</span> <span class="n">lowest</span> <span class="mi">10</span> <span class="n">singlet</span> <span class="n">states</span> <span class="k">with</span> <span class="n">A</span> <span class="n">symmetry</span>

                      <span class="n">Generalized</span> <span class="n">Hamiltonian</span> <span class="n">Solver</span>
                            <span class="n">By</span> <span class="n">Andrew</span> <span class="n">M</span><span class="o">.</span> <span class="n">James</span>

<span class="o">==&gt;</span> <span class="n">Options</span> <span class="o">&lt;==</span>

  <span class="n">Max</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span>        <span class="o">=</span> <span class="mi">60</span>
  <span class="n">Eigenvector</span> <span class="n">tolerance</span>           <span class="o">=</span> <span class="mf">1.0000e-04</span>
  <span class="n">Max</span> <span class="n">number</span> <span class="n">of</span> <span class="n">expansion</span> <span class="n">vectors</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="o">=&gt;</span> <span class="n">Iterations</span> <span class="o">&lt;=</span>
                            <span class="n">Max</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">value</span><span class="p">]]</span>     <span class="n">Max</span><span class="p">[</span><span class="o">|</span><span class="n">R</span><span class="o">|</span><span class="p">]</span>   <span class="c1"># vectors</span>
<span class="n">HamiltonianSolver</span> <span class="nb">iter</span>   <span class="mi">1</span><span class="p">:</span>   <span class="mf">5.64572e-01</span>  <span class="mf">3.65441e-01</span>     <span class="mi">40</span>
<span class="n">HamiltonianSolver</span> <span class="nb">iter</span>   <span class="mi">2</span><span class="p">:</span>   <span class="mf">1.70649e-02</span>  <span class="mf">4.40807e-02</span>     <span class="mi">60</span>
<span class="n">HamiltonianSolver</span> <span class="nb">iter</span>   <span class="mi">3</span><span class="p">:</span>   <span class="mf">2.42552e-04</span>  <span class="mf">6.95387e-03</span>     <span class="mi">80</span>
<span class="n">HamiltonianSolver</span> <span class="nb">iter</span>   <span class="mi">4</span><span class="p">:</span>   <span class="mf">2.34146e-06</span>  <span class="mf">7.75689e-04</span>    <span class="mi">100</span>
<span class="n">HamiltonianSolver</span> <span class="nb">iter</span>   <span class="mi">5</span><span class="p">:</span>   <span class="mf">1.75483e-08</span>  <span class="mf">6.17293e-05</span>    <span class="mi">120</span>      <span class="n">Converged</span>
</pre></div>
</div>
<p>When convergence is reached, <a href="#id12"><span class="problematic" id="id13">|PSIfour|</span></a> will output a report of excitation energies, oscillator strengths, and rotatory strenghts in atomic units:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                <span class="n">Excitation</span> <span class="n">Energy</span>         <span class="n">Total</span> <span class="n">Energy</span>        <span class="n">Oscillator</span> <span class="n">Strength</span>             <span class="n">Rotatory</span> <span class="n">Strength</span>
 <span class="c1">#   Sym: GS-&gt;ES (Trans)        au              eV              au          au (length)    au (velocity)    au (length)    au (velocity)</span>
<span class="o">----</span> <span class="o">--------------------</span> <span class="o">---------------</span> <span class="o">---------------</span> <span class="o">---------------</span> <span class="o">---------------</span> <span class="o">---------------</span> <span class="o">---------------</span> <span class="o">---------------</span>
 <span class="mi">1</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.26945</span>         <span class="mf">7.33199</span>        <span class="o">-</span><span class="mf">150.50964</span>       <span class="mf">0.0017</span>          <span class="mf">0.0082</span>         <span class="o">-</span><span class="mf">0.0019</span>         <span class="o">-</span><span class="mf">0.0135</span>
 <span class="mi">2</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.31534</span>         <span class="mf">8.58073</span>        <span class="o">-</span><span class="mf">150.46375</span>       <span class="mf">0.0000</span>          <span class="mf">0.0002</span>         <span class="o">-</span><span class="mf">0.0007</span>         <span class="o">-</span><span class="mf">0.0096</span>
 <span class="mi">3</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.35760</span>         <span class="mf">9.73076</span>        <span class="o">-</span><span class="mf">150.42148</span>       <span class="mf">0.0040</span>          <span class="mf">0.0097</span>          <span class="mf">0.0227</span>          <span class="mf">0.0352</span>
 <span class="mi">4</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.37522</span>         <span class="mf">10.21028</span>       <span class="o">-</span><span class="mf">150.40386</span>       <span class="mf">0.0144</span>          <span class="mf">0.0442</span>          <span class="mf">0.0729</span>          <span class="mf">0.1223</span>
 <span class="mi">5</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.43252</span>         <span class="mf">11.76960</span>       <span class="o">-</span><span class="mf">150.34656</span>       <span class="mf">0.0890</span>          <span class="mf">0.1189</span>         <span class="o">-</span><span class="mf">0.1942</span>         <span class="o">-</span><span class="mf">0.2491</span>
 <span class="mi">6</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.46952</span>         <span class="mf">12.77624</span>       <span class="o">-</span><span class="mf">150.30957</span>       <span class="mf">0.0640</span>          <span class="mf">0.1157</span>          <span class="mf">0.0175</span>          <span class="mf">0.0235</span>
 <span class="mi">7</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.49186</span>         <span class="mf">13.38426</span>       <span class="o">-</span><span class="mf">150.28722</span>       <span class="mf">0.0016</span>          <span class="mf">0.0012</span>         <span class="o">-</span><span class="mf">0.0243</span>         <span class="o">-</span><span class="mf">0.0212</span>
 <span class="mi">8</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.50405</span>         <span class="mf">13.71581</span>       <span class="o">-</span><span class="mf">150.27504</span>       <span class="mf">0.4557</span>          <span class="mf">0.4396</span>         <span class="o">-</span><span class="mf">0.0197</span>         <span class="o">-</span><span class="mf">0.0158</span>
 <span class="mi">9</span>        <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.52971</span>         <span class="mf">14.41407</span>       <span class="o">-</span><span class="mf">150.24938</span>       <span class="mf">0.0799</span>          <span class="mf">0.0948</span>          <span class="mf">0.0546</span>          <span class="mf">0.0595</span>
 <span class="mi">10</span>       <span class="n">A</span><span class="o">-&gt;</span><span class="n">A</span> <span class="p">(</span><span class="mi">1</span> <span class="n">A</span><span class="p">)</span>       <span class="mf">0.56083</span>         <span class="mf">15.26092</span>       <span class="o">-</span><span class="mf">150.21825</span>       <span class="mf">0.0497</span>          <span class="mf">0.0567</span>         <span class="o">-</span><span class="mf">0.0587</span>         <span class="o">-</span><span class="mf">0.0650</span>
</pre></div>
</div>
<p>The solvers can be used to extract the first few roots of interest for the full
time-dependent DFT (TDDFT) equations, also known as the random-phase
approximation (RPA), or its Tamm--Dancoff approximation.
The former is a <em>generalized</em> eigenvalue problem and our solver leverages
the Hamiltonian structure of the equations to ensure robust convergence <a class="reference internal" href="bibliography.html#stratmann-1998" id="id4"><span>[stratmann:1998]</span></a>.
The latter is a Hermitian eigenvalue problem and we employ a Davidson solver.</p>
</section>
<section id="known-limitations">
<h2>Known limitations<a class="headerlink" href="#known-limitations" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The implementation cannot currently handle the following cases:
- Functionals with meta or VV10 components.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The length-gauge rotatory strengths <a href="#id14"><span class="problematic" id="id15">|PSIfour|</span></a> computes are
currently <strong>not</strong> gauge-origin invariant.</p>
</div>
</section>
<section id="theory">
<span id="index-1"></span><h2>Theory<a class="headerlink" href="#theory" title="Link to this heading">¶</a></h2>
<p>The excitation energies and corresponding states are obtained from the following generalized
eigenvalue problem, also known as the <em>response eigenvalue problem</em>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
    \mathbf{A} &amp; \mathbf{B} \\
    \mathbf{B}^{*} &amp; \mathbf{A}^{*}
  \end{pmatrix}
  \begin{pmatrix}
    \mathbf{X}_{n} \\
    \mathbf{Y}_{n}
  \end{pmatrix}
  =
  \omega_{n}
  \begin{pmatrix}
    \mathbf{1} &amp; \mathbf{0} \\
    \mathbf{0} &amp; -\mathbf{1}
  \end{pmatrix}
\begin{pmatrix}
  \mathbf{X}_{n} \\
  \mathbf{Y}_{n}
\end{pmatrix}.\end{split}\]</div>
<p>This approach has the advantage that there is no need to explicitly parametrize
the wavefunctions of the molecular excited states. Furthermore, the excitation
eigenvectors, <span class="math notranslate nohighlight">\((\mathbf{X}_{n} \mathbf{Y}_{n})^{t}\)</span>,
provide information on the nature of the transitions and can be used to form
spectroscopic observables, such as oscillator and rotatory strengths.</p>
<p>The <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> matrices appearing on the left-hand side are
the blocks of the molecular electronic
Hessian, <a class="reference internal" href="bibliography.html#norman2018-tn" id="id5"><span>[Norman2018-tn]</span></a>
whose dimensionality is <span class="math notranslate nohighlight">\((OV)^{2}\)</span>, with <span class="math notranslate nohighlight">\(O\)</span> and <span class="math notranslate nohighlight">\(V\)</span> the number of occupied and
virtual molecular orbitals, respectively.
This prevents explicit formation of the full Hessian, and subspace iteration
methods need to be used to extract the first few roots.
In such methods, the eigenvectors are expanded in a subspace of trial vectors,
whose dimensionality is greatly lower than that of the full eigenproblem.
The Hessian is projected down to this subspace where conventional full
diagonalization algorithms can be applied. The subspace is augmented with new
trial vectors, until a suitable convergence criterion is met.
The efficiency of the subspace solver is determined by the first half-projection
of the Hessian in the trial subspace, that is, by the efficiency of the routines
performing the matrix-vector products.</p>
<p>It is essential to note that, despite the hermiticity of the molecular
electronic Hessian, the response eigenvalue equation is not an Hermitian
eigenproblem, due to the nonunit metric on the right-hand side. Indeed the Davidson
solver, the standard subspace iteration method in quantum chemistry,
demonstrates very poor convergence, sometimes manifesting as spurious complex
eigenvalues.
The eigenproblem however has Hamiltonian symmetry: the
roots appear in pairs <span class="math notranslate nohighlight">\((\omega_{n}, -\omega_{n})\)</span>, as do the eigenvectors.
A robust subspace solver should preserve the Hamiltonian symmetry, by enforcing
the paired structure on the trial vectors themselves.
Since <a href="#id16"><span class="problematic" id="id17">|PSIfour|</span></a> employs real orbitals, the response eigenproblem can be brought
to the form:</p>
<div class="math notranslate nohighlight">
\[(\mathbf{A} - \mathbf{B})(\mathbf{A} + \mathbf{B})| \mathbf{X}_{n} + \mathbf{Y}_{n}\rangle
=
\omega^{2}_{n} | \mathbf{X}_{n} + \mathbf{Y}_{n}\rangle,\]</div>
<p>and further to the Hermitian form:</p>
<div class="math notranslate nohighlight">
\[(\mathbf{A} - \mathbf{B})^{\frac{1}{2}}(\mathbf{A} + \mathbf{B})(\mathbf{A} - \mathbf{B})^{\frac{1}{2}} \mathbf{T}_{n}
=
\omega^{2}_{n} \mathbf{T}_{n},\]</div>
<p>assuming the SCF reference is stable, <em>i.e.</em> <span class="math notranslate nohighlight">\((\mathbf{A}-\mathbf{B})\)</span> is positive-definite.
The paired vectors <span class="math notranslate nohighlight">\(| \mathbf{X}_{n} - \mathbf{Y}_{n}\rangle\)</span> are left
eigenvectors and form a biorthonormal set together
with the right eigenvectors <span class="math notranslate nohighlight">\(| \mathbf{X}_{n} + \mathbf{Y}_{n}\rangle\)</span>.</p>
<p>The algorithm for the subspace iteration Hamiltonian solver implemented in <a href="#id18"><span class="problematic" id="id19">|PSIfour|</span></a>
was first described by Stratmann <em>et al.</em> <a class="reference internal" href="bibliography.html#stratmann-1998" id="id6"><span>[stratmann:1998]</span></a>.
As already mentioned, the formation and storage of the matrix-vector products
<span class="math notranslate nohighlight">\((\mathbf{A}+\mathbf{B})\mathbf{b}_{i}\)</span> and
<span class="math notranslate nohighlight">\((\mathbf{A}-\mathbf{B})\mathbf{b}_{i}\)</span> for all trial vectors <span class="math notranslate nohighlight">\(\mathbf{b}_{i}\)</span>
are the most compute- and memory-intensive operations in the Hamiltonian solver.
These matrix-vector products are equivalent to building generalized Fock
matrices and thus use the efficient <span class="math notranslate nohighlight">\(JK\)</span> build infrastructure of <a href="#id20"><span class="problematic" id="id21">|PSIfour|</span></a>.</p>
<p>The excitation energies and eigenvectors can then be used to compute transition moments, such as
electric and magnetic transition dipole moments, and spectroscopic intensities,
such as oscillator strengths and rotatory strengths <a class="reference internal" href="bibliography.html#pedersen1995-du" id="id7"><span>[Pedersen1995-du]</span></a>, <a class="reference internal" href="bibliography.html#lestrange2015-xn" id="id8"><span>[Lestrange2015-xn]</span></a>.
For example, <a href="#id22"><span class="problematic" id="id23">|PSIfour|</span></a> will compute compute oscillator strengths from
the MO basis electric dipole moment integrals, <span class="math notranslate nohighlight">\(\mathbf{\mu}_{u}\)</span>, and the right
excitation vectors, <span class="math notranslate nohighlight">\(|\mathbf{X}_{n}+\mathbf{Y}_{n}\rangle\)</span>:</p>
<div class="math notranslate nohighlight">
\[f = \frac{2}{3} \omega_{n} \sum_{u=x,y,z}\sum_{ia}|(\mathbf{X}_{n}+\mathbf{Y}_{n})_{ia}\mu_{ai, u}|^{2}.\]</div>
</section>
<section id="psithon-keywords">
<h2>Psithon keywords<a class="headerlink" href="#psithon-keywords" title="Link to this heading">¶</a></h2>
</section>
<section id="psiapi-usage">
<h2>PsiAPI usage<a class="headerlink" href="#psiapi-usage" title="Link to this heading">¶</a></h2>
<p>The TDSCF functionality is also accessible from PsiAPI. The example calculation shown above can be carried out as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psi4</span>

<span class="kn">from</span> <span class="nn">psi4.driver.procrouting.response.scf_response</span> <span class="kn">import</span> <span class="n">tdscf_excitations</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="s2">&quot;h2o2.out&quot;</span><span class="p">)</span>

<span class="n">h2o2</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;0 1</span>
<span class="s2">O        0.000000    0.695000   -0.092486</span>
<span class="s2">O       -0.000000   -0.695000   -0.092486</span>
<span class="s2">H       -0.388142    0.895249    0.739888</span>
<span class="s2">H        0.388142   -0.895249    0.739888</span>
<span class="s2">symmetry c1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;H2O2&quot;</span><span class="p">)</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span>
    <span class="s1">&#39;save_jk&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">e</span><span class="p">,</span> <span class="n">wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="s2">&quot;HF/cc-pvdz&quot;</span><span class="p">,</span> <span class="n">return_wfn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">h2o2</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">tdscf_excitations</span><span class="p">(</span><span class="n">wfn</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="plotting-one-photon-absorption-and-electronic-circular-dichroism-spectra">
<h2>Plotting one-photon absorption and electronic circular dichroism spectra<a class="headerlink" href="#plotting-one-photon-absorption-and-electronic-circular-dichroism-spectra" title="Link to this heading">¶</a></h2>
<p>Excitation energies and corresponding spectroscopic observables can be used to
produce spectra for one-photon absorption (OPA) and electronic circular
dichroism (ECD) with phenomenological line broadening.</p>
<p><a href="#id24"><span class="problematic" id="id25">|PSIfour|</span></a> provides the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> function for this purpose implementing the
recommendations of Rizzo <em>et al.</em> <a class="reference internal" href="bibliography.html#rizzo2011-to" id="id9"><span>[Rizzo2011-to]</span></a>.
This function will <em>not</em> plot the spectrum, but rather return a pair of NumPy
arrays containing the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> values resulting from the
convolution with broadening of the computed spectroscopic observables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">psi4</span>

<span class="kn">from</span> <span class="nn">psi4.driver.procrouting.response.scf_response</span> <span class="kn">import</span> <span class="n">tdscf_excitations</span>
<span class="kn">from</span> <span class="nn">psi4.driver.p4util</span> <span class="kn">import</span> <span class="n">spectrum</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="s2">&quot;moxy.out&quot;</span><span class="p">)</span>

<span class="n">moxy</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;0 1</span>
<span class="s2">C  0.152133 -0.035800  0.485797</span>
<span class="s2">C -1.039475  0.615938 -0.061249</span>
<span class="s2">C  1.507144  0.097806 -0.148460</span>
<span class="s2">O -0.828215 -0.788248 -0.239431</span>
<span class="s2">H  0.153725 -0.249258  1.552136</span>
<span class="s2">H -1.863178  0.881921  0.593333</span>
<span class="s2">H -0.949807  1.214210 -0.962771</span>
<span class="s2">H  2.076806 -0.826189 -0.036671</span>
<span class="s2">H  2.074465  0.901788  0.325106</span>
<span class="s2">H  1.414895  0.315852 -1.212218</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;(S)-methyloxirane&quot;</span><span class="p">)</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span>
    <span class="s1">&#39;save_jk&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">e</span><span class="p">,</span> <span class="n">wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="s2">&quot;HF/cc-pvdz&quot;</span><span class="p">,</span> <span class="n">return_wfn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">moxy</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">tdscf_excitations</span><span class="p">(</span><span class="n">wfn</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">triplets</span><span class="o">=</span><span class="s2">&quot;also&quot;</span><span class="p">)</span>

<span class="c1"># get poles and residues to plot OPA and ECD spectra</span>
<span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;EXCITATION ENERGY&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
<span class="n">opa_residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;LENGTH-GAUGE ELECTRIC DIPOLE TRANSITION MOMENT&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
<span class="n">ecd_residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;LENGTH-GAUGE ROTATORY STRENGTH&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>

<span class="n">opa_spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">(</span><span class="n">poles</span><span class="o">=</span><span class="n">poles</span><span class="p">,</span> <span class="n">residues</span><span class="o">=</span><span class="n">opa_residues</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">out_units</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
<span class="n">ecd_spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">(</span><span class="n">poles</span><span class="o">=</span><span class="n">poles</span><span class="p">,</span> <span class="n">residues</span><span class="o">=</span><span class="n">ecd_residues</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ECD&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">out_units</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The data produced by running the above PsiAPI code can, for example, be used
with the Altair plotting library to produce the desired spectra.</p>
<a class="reference internal image-reference" href="moxy.png"><img alt="(S)-methyloxirane one-photon absorption and electronic circular dichroism spectra." class="align-center" src="moxy.png" /></a>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Psi4 Documentation</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Harishankar.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/doc/sphinxman/source/tdscf.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>